# SSL

### SSL을 이용했을때의 이점
 - 통신 내용이 공격자에게 노출되는것을 방지
 - 접속하려는 서버가 신뢰할수 있는 서버인지를 판단
 - 통신내용의 악의적인 변경을 방지

### 대칭키
 - 암호화 복호화를 키를 통해 사용
 - 키값을 알아야만 사용이 가능 
 - 키값이 노출될수 있다는 취약점
 
### 공개키
- 암호화와 복호화가 가능한 키 2개를 공개키와 비공개키로 설정

### 인증키의 원리
- 전송한 정보를 받은 사람이 자신이 가진 공개키로 그 정보를 복호화 하는 것에 성공했다면 그 정보의 주인이 비밀키를 받은 사람이라는 것을 보증

### SSL 인증서의 기능
- 클라이언트가 접속한 서버가 신뢰할수 있는 서버임을 보장
- SSL 통신에 사용할 공개키를 클라이언트에게 제공

### CA
- 어떤 서버가 신뢰할 수 있는지 보장해주는 기업
- SSL 서비스는 CA를 통해서 인증서를 구입

### SSL 인증서의 내용
- 서비스의정보(인증서를 발급한 CA, 서비스의 도메인 등)
- 서버 측 공개키(공개키의 내용, 공개키의 암호화방법)

### SSL 인증방법
 1. 브라우저가 서버에 접속할 때 제일먼저 인증서를 제공
 2. 브라우저는 이 인증서를 발급한 CA가 내장한 CA리스트에 있는지 확인
 3. 리스트에 포함되어 있다면 해당 CA의 공개키를 이용해 인증서를 복호화
 4. 복호화했다면 이 인증서가 CA의 비공개키에 의해 암호화 되었다는 것을 의미
 5. 해당 CA의 비공개키를 가지고 있는 CA는 해당 CA 밖에 없기 때문에 서버가 제공한 인증서가 CA에 의해 발급된 것을 의미
 6. CA에 의해 발급된 인증서라는 것은 접속한 사이트가 CA에 의해 검토되었다는 것을 의미
 7. CA의 검토를 통과했다는 것은 해당 서비스가 신뢰할수 있다는 것을 의미

## SSL 동작방법
### 1. handshake
 1. client hello - 클라이언트가 서버에 접속한다.
- 클라이언트 측에서 생성한 랜덤 데이터 전송
- 클라이언트가 지원하는 암호화 방식들 전송
	
2. server hello - 응답
- 서버측에서 생성한 랜덤 데이터 전송
- 클라이언트에게 받은 암호화 방식 중 서버가 선택한 클라이언트의 암호화 방식 전송
- 인증서 전송

3. 서버의 인증서를 SSL인증
- 클라이언트는 서버의 랜덤데이터와 클라이언트가 생성한 랜덤 데이터를 조합해서 pre master secret이라는 키를 생성 
- 이 암호화 기법은 대칭키이기 때문에 제 3자에게 노출되면 안된다.
- 서버의 공개키로 pre master secre 값을 암호화해서 서버로 전송하면 서버는 자신의 비공개키로 안전하게 복호화할 수있다.
- 서버의 공개키는 서버로부터 받은 인증서 안에 들어있다.

4. session key 생성
- 서버는 클라이언트가 전송한 pre master secret 값을 자신의 비공개 키로 복호화한다. 
- 서버와 클라이언트는 pre master secret 값을 master secret 값으로 만든다.
- master secret은 session key를 생성하는데 session key 값을 이용해 서버와 클라이언트는 데이터를 대칭키 방식으로 암호화 한 후에 주고받는다. 
- 이렇게 session key는 서버와 클라이언트가 모두 공유하게 되었다.

5. handshake 종료를 서로에게 알린다.

### 2. session
- 실제로 서버와 클라이언트가 데이터를 주고 받는 단계
- 실제 데이터를 session key를 사용해 대칭키 방식으로 암호화
- 상대방도 session key를 알고 있기 때문에 암호를 복호화 가능
- 공개키는 많은 컴퓨터 파워를 사용하기 때문에 대칭키와 공개키를 조합해서 사용

### 3. session close
-  SSL 통신이 끝났음을 서로에게 알린다.
- 사용한 대칭키인 session key는 폐기한다.