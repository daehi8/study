## 18. 상속보다는 컴포지션을 사용하라

### 상속

- 코드를 재사용하는 강력한 수단이지만 잘못 사용하면 오류를내기 쉬운 소프트웨어를 만들게 된다.
- 상위 클래스와 하위 클래스를 모두 같은 프로그래머가 통제하는 패키지 안에서라면 상속도 안전한 방법이다.
- 확장할 목적으로 설계되었고 문서화도 잘된 클래스의 상속도 안전하다.
- 다른 패키지의 구체 클래스를 상속하는 일은 위험하다.



### 상속과 캡슐화

- 메서드 호출과 달리 상속은 캡슐화를 깨뜨린다.
- 상위 클래스가 어떻게 구현되느냐에 따라 하위 클래스의 동작에 이상이 생길 수 있다.
- 상위 클래스 설계자가 확장을 충분히 고려하고 문서화도 제대로 해두지 않으면 하위 클래스는 상위 클래스의 변화에 발맞춰 수정되어야 한다.
- 자신의 다른 부분을 사용하는 자기사용 여부는 해당 클래스의 내부 구현 방식에 해당하며 다음 릴리스에서 유지되는지 알 수 없다.
- 상위 클래스의 메서드 동작을 다시 구현하는 방식은 어렵고 시간이 들며 오류를 내거나 성능을 떨어뜨릴 수 있다.
- 상위 클래스에 새로운 메서드를 추가하는 방식은 또 다른 추가 메서드가 만들어지면 오류가 날 수 있다.
- 클래스를 확장하더라도 메서드를 재정의하는 대신 새로운 메서드를 추가하는 방식은 훨씬 안전한 것은 맞지만 위험이 전혀 없는 것은 아니다.



### 컴포지션

- 기존 클래스를 확장하는 대신 새로운 클래스를 만들고 private 필드로 기존 클래스의 인스턴스를 참조하게 해야 한다.
- 기존 클래스가 새로운 클래스의 구성요소로 쓰인다는 뜻에서 이러한 설계를 컴포지션이라 한다.
- 새 클래스의 메서드들을 전달 메서드라 부른다.
- 그 결과 새로운 클래스는 기존 클래스의 내부 구현 방식의 영향에서 벗어나며 기존 클래스에 새로운 메서드가 추가되더라도 전혀 영향받지 않는다.



### 래퍼 클래스

- 다른 인스턴스를 감싸고 있다는 뜻에서 래퍼클래스라고 한다.
- 단점이 거의 없지만 한 가지 래퍼 클래스가 콜백 프레임워크와 어울리지 않는다는 점만 주의하면 된다.
- 콜백 프레임워크에서는 자기 자신의 참조를 다른 객체에 넘겨서 다음 호출때 사용하도록 한다.
- 내부 객체는 자신을 감싸고 있는 래퍼의 존재를 모르니 대신 자신의 참조를 넘기고 콜백 때는 래퍼가 아닌 내부 객체를 호출하게 한다.
- 재사용할 수 있는 전달 클래스를 인터페이스당 하나씩만 만들어두면 원하는 기능을 덧씌우는 전달 클래스들을 아주 손쉽게 구현할 수 있다.



### 상속 주의사항

- 상속은 반드시 하위 클래스가 상위 클래스의 진짜 하위 타입인 상황에서만 쓰여야 한다.
- 필수 구성요소가 아니면 상위 클래스를 private 인스턴스로 두고 상위 클래스와는 다른 API를 제공해야 한다.



### 컴포지션 주의사항

- 컴포지션을 써야 할 상황에서 상속을 사용하는 것은 내부 구현을 불필요하게 노출하는 것이다.
- API가 내부 구현에 묶이고 클래스의 성능도 제한된다.
- 클라이언트가 노출된 내부에 직접 접근할 수 있다는 문제도 생긴다.
- 사용자를 혼란스럽게 할 수 있다.
- 클라이언트에서 상위 클래스를직접 수정하여 하위 클래스의 불변식을 해칠 수 있다.



### 컴포지션과 상속

- 확장하려는 클래스의 API에 아무런 결함이 없는지 확인해야 한다.
- 결함이 있다면 이 결함이 클래스의 API까지 전파되도 괜찮은지 확인해야 한다.
- 컴포지션으로  결함을 숨기는 새로운 API를 설계할 수 있지만 상속은 상위 클래스의 API를 그 결함까지 그대로 승계한다.
- 상속은 강력하지만 캡슐화를 해친다는 문제가 있다.
- 상속은 상위 클래스와 하위 클래스가 동일한 관계일 때 써야 한다.
- 상속의 취약점을 피하려면 상속 대신 컴포지션과 전달을 사용해야 한다.
- 래퍼 클래스로 구현할 적당한 인터페이스가 있다면 더욱 컴포지션과 전달을 사용해야 한다.
- 래퍼 클래스는 하위 클래스보다 견고하고 강력하다.



