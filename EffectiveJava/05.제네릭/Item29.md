## 29. 이왕이면 제네릭 타입으로 만들라

### 제네릭 타입을 새로 만드는 일

- 일반 클래스를 제네릭 클래스로 만드는 첫 단계는 클래스 선언에 타입 매개변수를 추가하는 일이다.
- 타입 이름으로는 보통 E를 사용한다.



### 배열을 사용하는 코드

- E와 같은 실체화 불가 타입으로는 배열을 만들 수 없다.
- 배열을 사용하는 코드를 제네릭으로 만들려 할 때는 이 문제가 항상 생길 것이다.



### 제너릴 배열 생성을 제거하는 방법

1. 제네릭 배열 생성 금지 제약 우회
   - Object 배열을 생성한 다음 제네릭 배열로 형변환한다.
   - 컴파일러는 오류 대신 경고만을 보내지만 타입 안전하지 않다.
   - 비검사 형변환이 프로그램의 타입 안전성을 해치지 않음을 스스로 확인해야 한다.
   - 비검사 형변환이 안전함을 직접 증명했다면 범위를 최소로 좁혀 @SuppressWarnings 애너테이션으로 해당 경고를 숨긴다.
   - 애너테이션을 달면 Stack은 깔끔히 컴파일되고 명시적으로 형변환하지 않아도 ClassCastException 걱정 없이 사용할 수 있다.

2. elements 필드의 타입을 E[]에서 Object[]로 변경
   - 배열이 반환한 원소를 E로 형변환하면 오류 대신 경고가 뜬다.
   - E는 실체화 불가 타입이므로 컴파일러는 런타임에 이뤄지는 형변환이 안전한지 증명할 방법이 없다.
   - 직접 안전을 증명하고 비검사 형변환을 수행하는 할당문에서만 경고를 숨기면 된다.

- 첫 번째 방식에서는 형변환을 배열 생성 시 단 한번만 해주면 되지만 두 번째 방식에서는 배열에서 원소를 잃을 때마다 해줘야 한다.
- 현업에서는 첫 번째 방식을 더 선호하며 자주 사용한다.
- 하지만 배열의 런타임 타입이 컴파일타임 타입과 달라 힙 오염을 일으킨다.



### 배열과 리스트

- 제네릭 타입 안에서 리스트를 사용하는 게 항상 가능하지도 꼭 더 좋은 것도 아니다.
- 자바가 리스트를 기본 타입으로 제공하지 않으므로 ArrayList 같은 제네릭 타입도 결국은 기본 타입인 배열을 사용해 구현해야 한다.
- HashMap 같은 제네릭 타입은 성능을 높일 목적으로 배열을 사용하기도 한다.



### 타입 매개변수에 대한 제약

- 대다수의 제네릭 타입은 타입 매개변수에 아무런 제약을 두지 않는다.
- 단 기본 타입은 사용할 수 없다.
- 이는 제네릭 타입 시스템의 근본적인 문제이나 박싱된 기본 타입을 사용해 우회할 수 있다.
- 타입 매개변수에 제약을 두는 제네릭 타입도 있다.



### 핵심

- 클라이언트에서 직접 형변환해야 하는 타입보다 제네릭 타입이 더 안전하고 쓰기 편하다.
- 새로운 타입을 설계할 때는 형변환 없이도 사용할 수 있도록 해야 한다.
- 기존 타입 중 제네릭이었어야 하는게 있다면 제네릭 타입으로 변경해야 한다.
- 기존 클라이언트에는 아무 영향을 주지 않으면서 새로운 사용자를 훨씬 편하게 해주는 일이다.

